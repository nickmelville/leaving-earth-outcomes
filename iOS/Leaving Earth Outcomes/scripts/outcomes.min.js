!function(){var e,t="210216",n=document.querySelector("#footer"),o=document.querySelector("#mainContent"),i=document.querySelector("#addAdvancementButton"),a=document.querySelector("#showSettingsModalButton"),r=document.querySelector("#settingsModal"),c=document.querySelector("#normalViewButton"),s=document.querySelector("#compactViewButton"),m=document.querySelector("#resetButton"),d=document.querySelector("#resetGameModal"),u=d.querySelector("#resetModalYesButton"),l=d.querySelector("#resetModalCancelButton"),f=document.querySelector("#newAdvancementModal"),g=document.querySelector("#numberOfOutcomes"),h=document.querySelector("#outcomeResultModal"),v=h.querySelector("#outcomeContent"),y=h.querySelector("#shuffleOutcomesButton"),S=h.querySelector("#removeOutcomeButton"),b={nasa:{name:"NASA",bgColor:"#0099ff",fgColor:"#fff"},okb1:{name:"&#1054;&#1050;&#1041;-1",bgColor:"#ff4d4d",fgColor:"#fff"},sac:{name:"SAC",bgColor:"#ffff66",fgColor:"#000"},cnes:{name:"CNES",bgColor:"#737373",fgColor:"#fff"},isas:{name:"ISAS",bgColor:"#f2f2f2",fgColor:"#000"}},w=document.querySelector("#blanket"),p=navigator.userAgent.indexOf("iPhone")>-1||navigator.userAgent.indexOf("iPad")>-1?"touchend":"click",k={},D=function(e){var t,n,o;for(t=e.length-1;t>0;t--)n=Math.floor(Math.random()*(t+1)),o=e[t],e[t]=e[n],e[n]=o;return e},C=function(){var e,t=[];for(e=1;90>=e;e++)t.push(e);return D(t)},L=function(){return{version:t,config:{mode:"normal"},currentPlayer:"nasa",outcomesDeck:C(),discardDeck:[],players:{nasa:{advancements:{}},okb1:{advancements:{}},sac:{advancements:{}},cnes:{advancements:{}},isas:{advancements:{}}}}},x=function(){var t=document.documentElement.clientWidth,n=e.config;"normal"===n.mode&&(n.containerWidth=350>t?t-25:325,n.outcomeMargin=25,n.outcomeDimension=n.containerWidth/2-60,n.advancementMargin=n.outcomeDimension+40,n.advancementFontSize="20px"),"compact"===n.mode&&(n.containerWidth=185>t?t-25:160,n.outcomeMargin=20,n.outcomeDimension=n.containerWidth/2-50,n.advancementMargin=n.outcomeDimension+25,n.advancementFontSize="12px"),n.containerHeight=n.containerWidth/2,n.dialogWidth=350>t?t-25:325,n.advancementHeight=n.containerHeight-40,n.advancementWidth=n.containerWidth-25,n.maximumOutcomes={Surveying:1}},M=function(t){t.style.width=e.config.dialogWidth+"px",t.style.bottom="50%",t.style.left="50%",t.style.marginBottom="-"+t.offsetHeight/2+"px",t.style.marginLeft="-"+t.offsetWidth/2+"px",t.style.visibility="visible"},q=function(e){var t,n,o=f.querySelectorAll("span");for(t in e.advancements)if(e.advancements.hasOwnProperty(t))for(n=0;n<o.length;n++)e.advancements[t].name===o[n].getAttribute("data-name")&&-1===o[n].className.indexOf("disabled")&&N(o[n],"disabled")},E=function(){w.style.visibility="visible",R(),N(g.querySelector('[data-number="3"]'),"selected"),q(e.players[e.currentPlayer]),M(f)},O=function(){w.style.visibility="visible",M(d)},A=function(){window.Storage&&window.localStorage.removeItem("storedState"),window.location.reload()},P=function(e,t){e.className=e.className.replace(new RegExp(t,"g"),"").replace(/\s$/,"")},N=function(e,t){e.className+=" "+t},W=function(){var e,t,n=document.querySelectorAll("svg"),o=document.querySelectorAll("#newAdvancementModal span.disabled");for(e=0,t=n.length;t>e;e++)SVG(n[e]).remove();for(e=0,t=o.length;t>e;e++)P(o[e],"disabled");k={},U()},B=function(t){e.currentPlayer=t.target.id,F(),W(),Z()},F=function(){var e,t=document.querySelectorAll(".modal");for(e=0;e<t.length;e++)t[e].style.visibility="hidden";w.style.visibility="hidden"},H=function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},R=function(){var e=g.querySelector("span.selected"),t=g.querySelector("span.warning");e&&P(e,"selected"),t&&P(t,"warning")},I=function(t){var n,o,i,a,r=t.target,c=H(),s=g.querySelector("span.selected");if(r.className.indexOf("advancement")>-1&&-1===r.className.indexOf("disabled"))if(i=e.config.maximumOutcomes[r.getAttribute("data-name")],o=s.getAttribute("data-number"),o>i)n=g.querySelector('[data-number="'+i+'"]'),-1===n.className.indexOf("warning")&&N(n,"warning");else{if(e.outcomesDeck.length+e.discardDeck.length<o)return F(),void R();a={player:e.currentPlayer,id:c,name:r.getAttribute("data-name"),outcomes:[],maxLength:o,finalRevealed:!1},e.players[e.currentPlayer].advancements[c]=a,k[c]=new Q(a),F(),R(),U()}r.className.indexOf("number")>-1&&-1===r.className.indexOf("selected")&&(R(),N(r,"selected"))},V=function(){z(),w.style.visibility="visible",M(r)},z=function(){"normal"===e.config.mode&&(P(c,"disabled"),N(s,"disabled")),"compact"===e.config.mode&&(P(s,"disabled"),N(c,"disabled")),W(),Z()},T=function(t){"normalViewButton"===t.target.id&&"compact"===e.config.mode&&(e.config.mode="normal",z()),"compactViewButton"===t.target.id&&"normal"===e.config.mode&&(e.config.mode="compact",z()),t.target.id in b&&(t.target.id!==e.currentPlayer?B(t):F())},G=function(){i.addEventListener(p,E),a.addEventListener(p,V),f.addEventListener(p,I),r.addEventListener(p,T),m.addEventListener(p,O),u.addEventListener(p,A),l.addEventListener(p,F),w.addEventListener(p,F)},j=function(){var t,n=e.players[e.currentPlayer].advancements;for(t in n)n.hasOwnProperty(t)&&(k[t]=new Q(n[t]))},J=function(){e.outcomesDeck=D(e.discardDeck),e.discardDeck=[]},Y=function(t){var n=SVG(o).size(e.config.containerWidth,e.config.containerHeight);return n.rect(e.config.advancementWidth,e.config.advancementHeight).attr({x:15,y:15,fill:"#fff",stroke:"#000"}).radius(3),n.text(t).attr({x:e.config.advancementMargin,y:e.config.outcomeMargin}).font({family:"Helvetica",size:e.config.advancementFontSize}),n.image("img/0.png").attr({width:e.config.outcomeDimension,height:e.config.outcomeDimension,x:e.config.outcomeMargin,y:e.config.outcomeMargin}),n},$=function(t,n,o){var i;switch(t){case 2:i="img/3.png";break;case 1:i="img/2.png";break;case 0:i="img/1.png"}return{outcomeCard:n.rect(e.config.outcomeDimension,e.config.outcomeDimension).attr({x:e.config.outcomeMargin,y:e.config.outcomeMargin,fill:"#fff",stroke:"#000",id:o}).radius(3),outcomeImage:n.image(i).attr({width:e.config.outcomeDimension,height:e.config.outcomeDimension,x:e.config.outcomeMargin,y:e.config.outcomeMargin,id:o})}},K=function(){y.className.indexOf("disabled")>-1&&P(y,"disabled")},Q=function(t){var n,o,i,a,r=this;for(this.player=t.player,this.outcomes=t.outcomes,this.maxLength=t.maxLength,this.name=t.name,this.finalRevealed=t.finalRevealed,this.id=t.id,this.showOutcomeResult=function(){var t=r.outcomesDeck.last().attr("outcome"),n=1===r.outcomesDeck.members.length,o=function(){v.innerHTML="Success!",n?(N(y,"disabled"),y.removeEventListener(p,a),w.addEventListener(p,c)):w.addEventListener(p,a)},i=function(){w.addEventListener(p,a),76>t?v.innerHTML="Minor Failure!":91>t&&(v.innerHTML="Major Failure!")},a=function(){var t=r.id,o=[],i=0;n&&(r.showFinalCard(),e.players[e.currentPlayer].advancements[t].finalRevealed=!0),r.outcomesDeck.each(function(){o.push(this.attr("outcome"))}),o=D(o),r.outcomesDeck.each(function(){this.attr({outcome:o[i]}),i++}),U(),s()},c=function(){var n,o,i=r.id,a=[],c=0;for(r.outcomesDeck.last().remove(),r.outcomesDeck.members.pop(),n=r.outcomesDeck.members,o=0;o<n.length;o++)a.push(n[o].attr("outcome")),c+=1;e.players[e.currentPlayer].advancements[i].outcomes=a,e.players[e.currentPlayer].advancements[i].maxLength=c,e.discardDeck.push(t),U(),s()},s=function(){w.removeEventListener(p,a),w.removeEventListener(p,c),h.removeEventListener(p,c),y.removeEventListener(p,a),S.removeEventListener(p,c),w.addEventListener(p,F),F()};y.addEventListener(p,a),S.addEventListener(p,c),w.style.visibility="visible",K(),M(h),w.removeEventListener(p,F),61>t?o():i()},this.showFinalCard=function(){var e=1===this.outcomesDeck.members.length,t=this.outcomesDeck.last().attr("outcome"),n=76>t?"img/minor.png":"img/major.png";e&&this.outcomesDeck.last().get(1).load(n)};this.outcomes.length<this.maxLength;)e.outcomesDeck.length||J(),this.outcomes.push(e.outcomesDeck.shift());for(this.outcomes=D(this.outcomes),this.advancementContainer=Y(this.name),this.outcomesDeck=this.advancementContainer.set(),n=0,o=this.outcomes.length;o>n;n++)i=$(n,this.advancementContainer,this.id),a=this.advancementContainer.group(),a.add(i.outcomeCard),a.add(i.outcomeImage),a.attr({id:this.id,outcome:this.outcomes[n],x:i.outcomeCard.x(),y:i.outcomeImage.y()}),this.outcomesDeck.add(a);return this.finalRevealed===!0&&1===this.outcomesDeck.members.length&&this.showFinalCard(),this.outcomesDeck.on("click",this.showOutcomeResult),{outcomesDeck:this.outcomesDeck,showFinalCard:this.showFinalCard,showOutcomeResult:this.showOutcomeResult}},U=function(){window.Storage&&(window.localStorage.removeItem("storedState"),window.localStorage.setItem("storedState",JSON.stringify(e)))},X=function(){var t=b[e.currentPlayer].bgColor,o=b[e.currentPlayer].fgColor;n.style.backgroundColor=t,n.style.color=o,a.innerHTML=b[e.currentPlayer].name},Z=function(){e=window.Storage&&window.localStorage.getItem("storedState")?JSON.parse(window.localStorage.getItem("storedState")):{},e.version!==t&&(e=L()),X(),x(),G(),j(),U()};Z(),FastClick.attach(document.body)}();